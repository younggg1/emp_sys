# 基于Web的大学毕业生就业情况调查系统开发流程与数据库设计

## 一、需求分析

### 1. 系统概述
- **目标**：开发一个单一学校的Web系统，用于管理毕业生就业信息和反馈，支持学生、辅导员、管理员三类用户，数据隔离限于班级。
- **核心功能**：
  - **学生端**：登录后只能查看个人信息、登记和查看自己的就业信息及反馈，就业信息和反馈登记依赖当前登录学生用户信息（`user_id`）。
  - **辅导员端**：管理本班学生信息、审核就业信息和反馈、查看本班统计。
  - **管理员端**：管理用户、权限、系统设置，查看全校统计。
- **非功能性要求**：
  - 数据隔离：学生只能操作自己的数据，辅导员限于本班，管理员无限制。
  - 可视化：使用ECharts展示本班（辅导员）和全校（管理员）就业统计（饼图、折线图）。
  - 验证码：纯前端验证，开关由`system_settings.require_captcha`控制。
  - 记住这个原则：Controller层调用Service层Service层调用Mapper层保持清晰的分层架构，每一层都有明确的职责不应该跨层调用或依赖框架自动生成的CRUD方法；
  
### 2. 角色与功能
1. **学生端**：
   - **登录**：输入用户名（学号）、密码，验证码（由`system_settings.require_captcha`控制）。
   - **个人信息**：查看学号、姓名、年级、班级、学院、专业、辅导员姓名、就业状态。
   - **就业信息登记**：提交企业性质、公司、职位、月薪、入职日期、地区（城市选择），无需输入姓名和专业（从`students`表获取），需辅导员审核。
   - **就业反馈**：提交就业阶段和反馈内容（需就业状态为已就业），需辅导员审核。
   - **查看**：只能查看自己的就业信息和反馈记录，SQL过滤`student_id = 当前登录user_id`。
   - **增删改查**：管理自己的就业信息和反馈（仅限待审核状态）。

2. **辅导员端**：
   - **登录**：输入用户名（工号）、密码，验证码。
   - **本班管理**：查看本班学生花名册及就业状态（已就业/未就业）。
   - **审核**：审核本班学生的就业信息和反馈（通过或待审核）。
   - **查询**：查看本班就业信息和反馈。
   - **统计分析**：本班就业分布（地区、薪资、企业性质，饼图）和历年趋势（折线图）。

3. **管理员端**：
   - **登录**：输入用户名、密码，验证码。
   - **用户管理**：添加学生（学号、姓名、年级、班级、学院、专业、辅导员）、添加辅导员（工号、姓名），重置密码、删除用户。
   - **权限分配**：为辅导员分配删除本班数据的权限。
   - **系统设置**：控制验证码开关（`require_captcha`）。
   - **查询**：就业信息、反馈（无需审核）。
   - **统计分析**：全校就业分布（地区、薪资、企业性质，饼图）和历年趋势（折线图）。

### 3. 数据隔离
- **学生**：通过`user_id`（即`student_id`）限制只能操作自己的数据。
- **辅导员**：通过`counselor_id`关联`students`表，只能访问本班数据。
- **管理员**：无限制，访问全校数据。

## 二、数据库设计

### 1. 表结构
所有主键均为`BIGINT AUTO_INCREMENT`，确保自增生成ID。`employment_records`去掉`name`和`major`，依赖`students`表。

1. **users（用户表）**
   - 功能：存储所有用户的登录信息。
   - 字段：
     - `user_id` (BIGINT, 主键, 自增)：用户ID。
     - `username` (VARCHAR(50), 唯一)：用户名（学号/工号/管理员账号）。
     - `password` (VARCHAR(100))：密码（明文，学术简化）。
     - `role` (ENUM('student', 'counselor', 'admin'))：角色。
     - `created_at` (DATETIME)：创建时间。
     - `updated_at` (DATETIME)：更新时间。

2. **students（学生信息表）**
   - 功能：存储学生详细信息，姓名和专业在此维护。
   - 字段：
     - `student_id` (BIGINT, 主键, 自增)：学生ID（关联`users.user_id`）。
     - `name` (VARCHAR(50))：姓名。
     - `grade` (VARCHAR(10))：年级（如2023）。
     - `class_name` (VARCHAR(50))：班级。
     - `college` (VARCHAR(50))：学院。
     - `major` (VARCHAR(50))：专业。
     - `counselor_id` (BIGINT, 外键)：辅导员ID（关联`users.user_id`）。
     - `employment_status` (ENUM('unemployed', 'employed'))：就业状态，默认`unemployed`。
     - `created_at` (DATETIME)：创建时间。
     - `updated_at` (DATETIME)：更新时间。
   - 外键：
     - `student_id` → `users.user_id` (CASCADE删除)。
     - `counselor_id` → `users.user_id` (RESTRICT删除)。
   - 索引：
     - `idx_counselor_id`：加速辅导员查询本班学生。
     - `idx_grade`：加速按年级统计。

3. **counselors（辅导员信息表）**
   - 功能：存储辅导员信息。
   - 字段：
     - `counselor_id` (BIGINT, 主键, 自增)：辅导员ID（关联`users.user_id`）。
     - `name` (VARCHAR(50))：姓名。
     - `created_at` (DATETIME)：创建时间。
     - `updated_at` (DATETIME)：更新时间。
   - 外键：
     - `counselor_id` → `users.user_id` (CASCADE删除)。

4. **employment_records（就业信息表）**
   - 功能：存储学生就业信息，学生只能登记和查看自己的记录（通过`student_id`）。
   - 字段：
     - `record_id` (BIGINT, 主键, 自增)：记录ID。
     - `student_id` (BIGINT, 外键)：学生ID。
     - `company_nature` (VARCHAR(50))：企业性质。
     - `company` (VARCHAR(100))：公司名称。
     - `position` (VARCHAR(50))：职位。
     - `salary` (DECIMAL(10,2))：月薪。
     - `entry_date` (DATE)：入职日期。
     - `region` (VARCHAR(50))：地区（城市）。
     - `status` (ENUM('pending', 'approved'))：审核状态，默认`pending`。
     - `created_at` (DATETIME)：创建时间。
     - `updated_at` (DATETIME)：更新时间。
   - 外键：
     - `student_id` → `students.student_id` (CASCADE删除)。
   - 索引：
     - `idx_student_id`：加速按学生查询。
     - `idx_region`：加速按地区统计。

5. **feedback_records（反馈信息表）**
   - 功能：存储学生反馈，学生只能登记和查看自己的反馈，需已就业。
   - 字段：
     - `feedback_id` (BIGINT, 主键, 自增)：反馈ID。
     - `student_id` (BIGINT, 外键)：学生ID。
     - `stage` (VARCHAR(50))：就业阶段。
     - `content` (TEXT)：反馈内容。
     - `status` (ENUM('pending', 'approved'))：审核状态，默认`pending`。
     - `created_at` (DATETIME)：创建时间。
     - `updated_at` (DATETIME)：更新时间。
   - 外键：
     - `student_id` → `students.student_id` (CASCADE删除)。
   - 索引：
     - `idx_student_id`：加速按学生查询。

6. **permissions（权限表）**
   - 功能：存储辅导员对本班数据的编辑和删除权限。
   - 字段：
     - `permission_id` (BIGINT, 主键, 自增)：权限ID。
     - `user_id` (BIGINT, 外键)：辅导员ID。
     - `can_edit` (BOOLEAN)：是否可编辑，默认`FALSE`。
     - `can_delete` (BOOLEAN)：是否可删除，默认`FALSE`。
     - `created_at` (DATETIME)：创建时间。
     - `updated_at` (DATETIME)：更新时间。
   - 外键：
     - `user_id` → `users.user_id` (CASCADE删除)。
   - 索引：
     - `idx_user_id`：加速按用户查询。

7. **system_settings（系统设置表）**
   - 功能：控制验证码和审核开关。
   - 字段：
     - `setting_id` (BIGINT, 主键, 自增)：设置ID。
     - `require_captcha` (BOOLEAN)：验证码开关，默认`TRUE`。
     - `require_approval` (BOOLEAN)：审核开关，默认`TRUE`。
     - `created_at` (DATETIME)：创建时间。
     - `updated_at` (DATETIME)：更新时间。

### 2. SQL文件
```sql
CREATE DATABASE IF NOT EXISTS employment_survey;
USE employment_survey;

-- 用户表
CREATE TABLE users (
    user_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(100) NOT NULL,
    role ENUM('student', 'counselor', 'admin') NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 学生信息表
CREATE TABLE students (
    student_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    grade VARCHAR(10) NOT NULL,
    class_name VARCHAR(50) NOT NULL,
    college VARCHAR(50) NOT NULL,
    major VARCHAR(50) NOT NULL,
    counselor_id BIGINT NOT NULL,
    employment_status ENUM('unemployed', 'employed') NOT NULL DEFAULT 'unemployed',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (counselor_id) REFERENCES users(user_id) ON DELETE RESTRICT,
    INDEX idx_counselor_id (counselor_id),
    INDEX idx_grade (grade)
);

-- 辅导员信息表
CREATE TABLE counselors (
    counselor_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (counselor_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 就业信息表
CREATE TABLE employment_records (
    record_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    student_id BIGINT NOT NULL,
    company_nature VARCHAR(50) NOT NULL,
    company VARCHAR(100) NOT NULL,
    position VARCHAR(50) NOT NULL,
    salary DECIMAL(10,2) NOT NULL,
    entry_date DATE NOT NULL,
    region VARCHAR(50) NOT NULL,
    status ENUM('pending', 'approved') NOT NULL DEFAULT 'pending',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES students(student_id) ON DELETE CASCADE,
    INDEX idx_student_id (student_id),
    INDEX idx_region (region)
);

-- 反馈信息表
CREATE TABLE feedback_records (
    feedback_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    student_id BIGINT NOT NULL,
    stage VARCHAR(50) NOT NULL,
    content TEXT NOT NULL,
    status ENUM('pending', 'approved') NOT NULL DEFAULT 'pending',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES students(student_id) ON DELETE CASCADE,
    INDEX idx_student_id (student_id)
);

-- 权限表
CREATE TABLE permissions (
    permission_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    can_edit BOOLEAN NOT NULL DEFAULT FALSE,
    can_delete BOOLEAN NOT NULL DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id)
);

-- 系统设置表
CREATE TABLE system_settings (
    setting_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    require_captcha BOOLEAN NOT NULL DEFAULT TRUE,
    require_approval BOOLEAN NOT NULL DEFAULT TRUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 插入测试数据
INSERT INTO system_settings (require_captcha, require_approval) VALUES (TRUE, TRUE);
INSERT INTO users (username, password, role) VALUES ('admin1', '123456', 'admin');
INSERT INTO users (username, password, role) VALUES ('counselor1', '123456', 'counselor');
INSERT INTO counselors (name, counselor_id) VALUES ('张老师', LAST_INSERT_ID());
INSERT INTO users (username, password, role) VALUES ('student1', '123456', 'student');
INSERT INTO students (name, grade, class_name, college, major, counselor_id, employment_status)
VALUES ('李明', '2023', '计算机1班', '计算机学院', '计算机科学', 2, 'unemployed');
```
